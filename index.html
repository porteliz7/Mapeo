<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gestor de Granja de Minería Bitcoin</title>
    <style>
        :root {
            --primary-color: #2c3e50;
            --secondary-color: #3498db;
            --accent-color: #e74c3c;
            --light-color: #ecf0f1;
            --dark-color: #2c3e50;
            --success-color: #2ecc71;
            --warning-color: #f39c12;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background-color: #f5f7fa;
            color: var(--dark-color);
            line-height: 1.6;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        
        header {
            background-color: var(--primary-color);
            color: white;
            padding: 1rem 0;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }
        
        header h1 {
            text-align: center;
            margin-bottom: 0.5rem;
        }
        
        .header-info {
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
        }
        
        .stats {
            display: flex;
            gap: 20px;
        }
        
        .stat-box {
            background-color: rgba(255,255,255,0.1);
            padding: 10px 15px;
            border-radius: 5px;
            text-align: center;
        }
        
        .stat-value {
            font-size: 1.5rem;
            font-weight: bold;
        }
        
        .controls {
            display: flex;
            gap: 10px;
            margin: 20px 0;
        }
        
        button {
            background-color: var(--secondary-color);
            color: white;
            border: none;
            padding: 10px 15px;
            border-radius: 5px;
            cursor: pointer;
            transition: background-color 0.3s;
        }
        
        button:hover {
            background-color: #2980b9;
        }
        
        .container-selector {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
        }
        
        .container-btn {
            flex: 1;
            padding: 15px;
            font-size: 1.2rem;
            background-color: var(--light-color);
            color: var(--dark-color);
            border: 2px solid #bdc3c7;
        }
        
        .container-btn.active {
            background-color: var(--secondary-color);
            color: white;
            border-color: var(--secondary-color);
        }
        
        .visualization {
            background-color: white;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            padding: 20px;
            margin-bottom: 20px;
        }
        
        .shelves-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 15px;
        }
        
        .shelf {
            background-color: var(--light-color);
            border-radius: 5px;
            padding: 15px;
            text-align: center;
            cursor: pointer;
            transition: transform 0.2s, box-shadow 0.2s;
        }
        
        .shelf:hover {
            transform: translateY(-3px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
        }
        
        .shelf h3 {
            margin-bottom: 10px;
        }
        
        .shelf-info {
            display: flex;
            justify-content: space-between;
            font-size: 0.9rem;
            color: #7f8c8d;
        }
        
        .machine-details {
            background-color: white;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            padding: 20px;
        }
        
        .machine-details h2 {
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 1px solid #eee;
        }
        
        .machine-form {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
        }
        
        .form-group {
            margin-bottom: 15px;
        }
        
        label {
            display: block;
            margin-bottom: 5px;
            font-weight: 600;
        }
        
        input, select {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
        }
        
        .machine-status {
            display: inline-block;
            padding: 5px 10px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: bold;
        }
        
        .status-active {
            background-color: var(--success-color);
            color: white;
        }
        
        .status-inactive {
            background-color: var(--warning-color);
            color: white;
        }
        
        .status-offline {
            background-color: var(--accent-color);
            color: white;
        }
        
        .tramos-grid {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 10px;
            margin-top: 15px;
        }
        
        .tramo {
            background-color: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 4px;
            padding: 10px;
            text-align: center;
        }
        
        .tramo h4 {
            margin-bottom: 10px;
        }
        
        .machine-slot {
            height: 30px;
            margin: 5px 0;
            border-radius: 4px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.8rem;
            cursor: pointer;
        }
        
        .slot-empty {
            background-color: #e9ecef;
            color: #6c757d;
        }
        
        .slot-occupied {
            background-color: var(--secondary-color);
            color: white;
        }
        
        .slot-problem {
            background-color: var(--accent-color);
            color: white;
        }
        
        @media (max-width: 768px) {
            .shelves-grid {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .machine-form {
                grid-template-columns: 1fr;
            }
            
            .tramos-grid {
                grid-template-columns: repeat(4, 1fr);
            }
        }
    </style>
</head>
<body>
    <header>
        <div class="container">
            <h1>Gestor de Granja de Minería Bitcoin</h1>
            <div class="header-info">
                <div class="stats">
                    <div class="stat-box">
                        <div class="stat-label">Máquinas Totales</div>
                        <div class="stat-value" id="total-machines">0/840</div>
                    </div>
                    <div class="stat-box">
                        <div class="stat-label">Activas</div>
                        <div class="stat-value" id="active-machines">0</div>
                    </div>
                    <div class="stat-box">
                        <div class="stat-label">Con Problemas</div>
                        <div class="stat-value" id="problem-machines">0</div>
                    </div>
                </div>
            </div>
        </div>
    </header>
    
    <main class="container">
        <div class="controls">
            <button id="add-machine-btn">Agregar Máquina</button>
            <button id="export-data-btn">Exportar Datos</button>
        </div>
        
        <div class="container-selector">
            <button class="container-btn active" data-container="1">Container 1</button>
            <button class="container-btn" data-container="2">Container 2</button>
            <button class="container-btn" data-container="3">Container 3</button>
        </div>
        
        <div class="visualization">
            <h2>Estantes - Container <span id="current-container">1</span></h2>
            <div class="shelves-grid" id="shelves-container">
                <!-- Los estantes se generarán dinámicamente con JavaScript -->
            </div>
        </div>
        
        <div class="machine-details" id="machine-details" style="display: none;">
            <h2>Detalles de la Máquina</h2>
            <div class="machine-form" id="machine-form">
                <!-- El formulario se generará dinámicamente con JavaScript -->
            </div>
        </div>
    </main>

    <script>
        // Datos de ejemplo para la demostración
        let farmData = {
            containers: [
                {
                    id: 1,
                    shelves: Array(8).fill().map((_, shelfIndex) => ({
                        id: shelfIndex + 1,
                        tramos: Array(7).fill().map((_, tramoIndex) => ({
                            id: tramoIndex + 1,
                            machines: Array(5).fill().map((_, machineIndex) => ({
                                id: null,
                                model: '',
                                status: 'empty',
                                hashrate: 0,
                                power: 0,
                                temperature: 0
                            }))
                        }))
                    }))
                },
                {
                    id: 2,
                    shelves: Array(8).fill().map((_, shelfIndex) => ({
                        id: shelfIndex + 1,
                        tramos: Array(7).fill().map((_, tramoIndex) => ({
                            id: tramoIndex + 1,
                            machines: Array(5).fill().map((_, machineIndex) => ({
                                id: null,
                                model: '',
                                status: 'empty',
                                hashrate: 0,
                                power: 0,
                                temperature: 0
                            }))
                        }))
                    }))
                },
                {
                    id: 3,
                    shelves: Array(8).fill().map((_, shelfIndex) => ({
                        id: shelfIndex + 1,
                        tramos: Array(7).fill().map((_, tramoIndex) => ({
                            id: tramoIndex + 1,
                            machines: Array(5).fill().map((_, machineIndex) => ({
                                id: null,
                                model: '',
                                status: 'empty',
                                hashrate: 0,
                                power: 0,
                                temperature: 0
                            }))
                        }))
                    }))
                }
            ]
        };

        // Variables globales
        let currentContainer = 1;
        let currentShelf = null;
        let currentTramo = null;
        let currentMachineIndex = null;

        // Inicializar la aplicación
        document.addEventListener('DOMContentLoaded', function() {
            // Cargar datos desde localStorage si existen
            const savedData = localStorage.getItem('bitcoinFarmData');
            if (savedData) {
                farmData = JSON.parse(savedData);
            }
            
            // Configurar eventos
            setupEventListeners();
            
            // Renderizar la vista inicial
            renderContainerSelector();
            renderShelves(currentContainer);
            updateStats();
        });

        // Configurar eventos
        function setupEventListeners() {
            // Selector de containers
            document.querySelectorAll('.container-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    document.querySelectorAll('.container-btn').forEach(b => b.classList.remove('active'));
                    this.classList.add('active');
                    currentContainer = parseInt(this.getAttribute('data-container'));
                    document.getElementById('current-container').textContent = currentContainer;
                    renderShelves(currentContainer);
                });
            });
            
            // Botón para agregar máquina
            document.getElementById('add-machine-btn').addEventListener('click', function() {
                showAddMachineForm();
            });
            
            // Botón para exportar datos
            document.getElementById('export-data-btn').addEventListener('click', function() {
                exportData();
            });
        }

        // Renderizar selector de containers
        function renderContainerSelector() {
            const containerSelector = document.querySelector('.container-selector');
            containerSelector.innerHTML = '';
            
            farmData.containers.forEach(container => {
                const btn = document.createElement('button');
                btn.className = `container-btn ${container.id === currentContainer ? 'active' : ''}`;
                btn.setAttribute('data-container', container.id);
                btn.textContent = `Container ${container.id}`;
                btn.addEventListener('click', function() {
                    document.querySelectorAll('.container-btn').forEach(b => b.classList.remove('active'));
                    this.classList.add('active');
                    currentContainer = parseInt(this.getAttribute('data-container'));
                    document.getElementById('current-container').textContent = currentContainer;
                    renderShelves(currentContainer);
                });
                containerSelector.appendChild(btn);
            });
        }

        // Renderizar estantes
        function renderShelves(containerId) {
            const shelvesContainer = document.getElementById('shelves-container');
            shelvesContainer.innerHTML = '';
            
            const container = farmData.containers.find(c => c.id === containerId);
            
            container.shelves.forEach(shelf => {
                const shelfElement = document.createElement('div');
                shelfElement.className = 'shelf';
                shelfElement.setAttribute('data-shelf', shelf.id);
                
                // Calcular estadísticas del estante
                let totalMachines = 0;
                let activeMachines = 0;
                let problemMachines = 0;
                
                shelf.tramos.forEach(tramo => {
                    tramo.machines.forEach(machine => {
                        if (machine.status !== 'empty') {
                            totalMachines++;
                            if (machine.status === 'active') activeMachines++;
                            if (machine.status === 'problem') problemMachines++;
                        }
                    });
                });
                
                shelfElement.innerHTML = `
                    <h3>Estante ${shelf.id}</h3>
                    <div class="shelf-info">
                        <span>Máquinas: ${totalMachines}/35</span>
                        <span>Activas: ${activeMachines}</span>
                    </div>
                    <div class="tramos-grid">
                        ${shelf.tramos.map(tramo => {
                            const occupied = tramo.machines.filter(m => m.status !== 'empty').length;
                            return `
                                <div class="tramo" data-tramo="${tramo.id}">
                                    <h4>Tramo ${tramo.id}</h4>
                                    <div>${occupied}/5 ocupados</div>
                                </div>
                            `;
                        }).join('')}
                    </div>
                `;
                
                // Agregar evento para mostrar detalles del estante
                shelfElement.addEventListener('click', function() {
                    showShelfDetails(containerId, shelf.id);
                });
                
                shelvesContainer.appendChild(shelfElement);
            });
        }

        // Mostrar detalles de un estante específico
        function showShelfDetails(containerId, shelfId) {
            const container = farmData.containers.find(c => c.id === containerId);
            const shelf = container.shelves.find(s => s.id === shelfId);
            
            // Crear modal para mostrar detalles del estante
            const modal = document.createElement('div');
            modal.style.position = 'fixed';
            modal.style.top = '0';
            modal.style.left = '0';
            modal.style.width = '100%';
            modal.style.height = '100%';
            modal.style.backgroundColor = 'rgba(0,0,0,0.7)';
            modal.style.display = 'flex';
            modal.style.justifyContent = 'center';
            modal.style.alignItems = 'center';
            modal.style.zIndex = '1000';
            
            modal.innerHTML = `
                <div style="background: white; padding: 20px; border-radius: 8px; max-width: 90%; max-height: 90%; overflow: auto;">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                        <h2>Container ${containerId} - Estante ${shelfId}</h2>
                        <button id="close-modal" style="background: #e74c3c;">Cerrar</button>
                    </div>
                    <div class="tramos-detailed">
                        ${shelf.tramos.map(tramo => `
                            <div style="margin-bottom: 20px;">
                                <h3>Tramo ${tramo.id}</h3>
                                <div style="display: grid; grid-template-columns: repeat(5, 1fr); gap: 10px;">
                                    ${tramo.machines.map((machine, index) => {
                                        let slotClass = 'slot-empty';
                                        let slotText = 'Vacío';
                                        
                                        if (machine.status === 'active') {
                                            slotClass = 'slot-occupied';
                                            slotText = machine.model || 'Máquina';
                                        } else if (machine.status === 'problem') {
                                            slotClass = 'slot-problem';
                                            slotText = machine.model || 'Problema';
                                        }
                                        
                                        return `
                                            <div class="machine-slot ${slotClass}" 
                                                 data-container="${containerId}"
                                                 data-shelf="${shelfId}"
                                                 data-tramo="${tramo.id}"
                                                 data-index="${index}">
                                                ${slotText}
                                            </div>
                                        `;
                                    }).join('')}
                                </div>
                            </div>
                        `).join('')}
                    </div>
                </div>
            `;
            
            document.body.appendChild(modal);
            
            // Configurar evento para cerrar modal
            document.getEl
